[{"/home/rmdadmin/Docs/aloop-frontend/src/index.tsx":"1","/home/rmdadmin/Docs/aloop-frontend/src/style/theme.ts":"2","/home/rmdadmin/Docs/aloop-frontend/src/components/app/App.tsx":"3","/home/rmdadmin/Docs/aloop-frontend/src/style/fontFaces.ts":"4","/home/rmdadmin/Docs/aloop-frontend/src/style/colors.ts":"5","/home/rmdadmin/Docs/aloop-frontend/src/components/app/authReducer.ts":"6","/home/rmdadmin/Docs/aloop-frontend/src/components/app/SocketProvider.tsx":"7","/home/rmdadmin/Docs/aloop-frontend/src/routes/Router.tsx":"8","/home/rmdadmin/Docs/aloop-frontend/src/utils/sockets/socketTemp.tsx":"9","/home/rmdadmin/Docs/aloop-frontend/src/pages/VideoPage.tsx":"10","/home/rmdadmin/Docs/aloop-frontend/src/routes/Paths.ts":"11","/home/rmdadmin/Docs/aloop-frontend/src/pages/Auth/ProfilePage.tsx":"12","/home/rmdadmin/Docs/aloop-frontend/src/pages/HomePage.tsx":"13","/home/rmdadmin/Docs/aloop-frontend/src/pages/Auth/LoginPage.tsx":"14","/home/rmdadmin/Docs/aloop-frontend/src/pages/Auth/RegisterPage.tsx":"15","/home/rmdadmin/Docs/aloop-frontend/src/api/authQueries.ts":"16","/home/rmdadmin/Docs/aloop-frontend/src/pages/templates/CenteredPage.tsx":"17","/home/rmdadmin/Docs/aloop-frontend/src/components/forms/Auth/LoginForm.tsx":"18","/home/rmdadmin/Docs/aloop-frontend/src/components/forms/Auth/RegisterForm.tsx":"19","/home/rmdadmin/Docs/aloop-frontend/src/api/defaults.ts":"20","/home/rmdadmin/Docs/aloop-frontend/src/config.ts":"21","/home/rmdadmin/Docs/aloop-frontend/src/utils/validators/passwordValidation.ts":"22","/home/rmdadmin/Docs/aloop-frontend/src/utils/validators/emailValidation.ts":"23","/home/rmdadmin/Docs/aloop-frontend/src/components/forms/template/FormTemplate.tsx":"24","/home/rmdadmin/Docs/aloop-frontend/src/utils/forms/MakeForm.tsx":"25","/home/rmdadmin/Docs/aloop-frontend/src/utils/text/stringAsNestedSelector.ts":"26","/home/rmdadmin/Docs/aloop-frontend/src/utils/text/camelToSentence.ts":"27","/home/rmdadmin/Docs/aloop-frontend/src/style/icons.ts":"28","/home/rmdadmin/Docs/aloop-frontend/src/api/videoQueries.ts":"29","/home/rmdadmin/Docs/aloop-frontend/src/utils/MakeAction.tsx":"30","/home/rmdadmin/Docs/aloop-frontend/src/components/video/VideoCall.tsx":"31","/home/rmdadmin/Docs/aloop-frontend/src/components/video/VideoPanel.tsx":"32","/home/rmdadmin/Docs/aloop-frontend/src/utils/useRefCallback.tsx":"33","/home/rmdadmin/Docs/aloop-frontend/src/api/messageQueries.ts":"34","/home/rmdadmin/Docs/aloop-frontend/src/components/chat/ChatWindow.tsx":"35","/home/rmdadmin/Docs/aloop-frontend/src/components/StartupChecks.tsx":"36"},{"size":664,"mtime":1613574076861,"results":"37","hashOfConfig":"38"},{"size":1704,"mtime":1613574076861,"results":"39","hashOfConfig":"38"},{"size":1712,"mtime":1618156176850,"results":"40","hashOfConfig":"38"},{"size":532,"mtime":1613574076861,"results":"41","hashOfConfig":"38"},{"size":14223,"mtime":1613574076861,"results":"42","hashOfConfig":"38"},{"size":1358,"mtime":1617977331430,"results":"43","hashOfConfig":"38"},{"size":972,"mtime":1616433726680,"results":"44","hashOfConfig":"38"},{"size":1915,"mtime":1616422038310,"results":"45","hashOfConfig":"38"},{"size":11652,"mtime":1617981209420,"results":"46","hashOfConfig":"38"},{"size":5615,"mtime":1617983280710,"results":"47","hashOfConfig":"38"},{"size":282,"mtime":1613574076861,"results":"48","hashOfConfig":"38"},{"size":996,"mtime":1613574076861,"results":"49","hashOfConfig":"38"},{"size":1667,"mtime":1615328168877,"results":"50","hashOfConfig":"38"},{"size":550,"mtime":1613574076861,"results":"51","hashOfConfig":"38"},{"size":423,"mtime":1613574076861,"results":"52","hashOfConfig":"38"},{"size":1805,"mtime":1618151870510,"results":"53","hashOfConfig":"38"},{"size":821,"mtime":1613574076861,"results":"54","hashOfConfig":"38"},{"size":3037,"mtime":1616792776590,"results":"55","hashOfConfig":"38"},{"size":3049,"mtime":1614634992640,"results":"56","hashOfConfig":"38"},{"size":425,"mtime":1614632598150,"results":"57","hashOfConfig":"38"},{"size":822,"mtime":1615335566897,"results":"58","hashOfConfig":"38"},{"size":105,"mtime":1613574076871,"results":"59","hashOfConfig":"38"},{"size":123,"mtime":1613574076871,"results":"60","hashOfConfig":"38"},{"size":729,"mtime":1616425271590,"results":"61","hashOfConfig":"38"},{"size":1909,"mtime":1616425241510,"results":"62","hashOfConfig":"38"},{"size":645,"mtime":1613574076871,"results":"63","hashOfConfig":"38"},{"size":363,"mtime":1613574076871,"results":"64","hashOfConfig":"38"},{"size":2413,"mtime":1617979885130,"results":"65","hashOfConfig":"38"},{"size":706,"mtime":1614634425630,"results":"66","hashOfConfig":"38"},{"size":1069,"mtime":1617980800900,"results":"67","hashOfConfig":"38"},{"size":6089,"mtime":1616620516000,"results":"68","hashOfConfig":"38"},{"size":545,"mtime":1616602035553,"results":"69","hashOfConfig":"38"},{"size":717,"mtime":1616596105253,"results":"70","hashOfConfig":"38"},{"size":2337,"mtime":1617898825345,"results":"71","hashOfConfig":"38"},{"size":3564,"mtime":1617983655330,"results":"72","hashOfConfig":"38"},{"size":872,"mtime":1618156118600,"results":"73","hashOfConfig":"38"},{"filePath":"74","messages":"75","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"76","usedDeprecatedRules":"77"},"9ozt8e",{"filePath":"78","messages":"79","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"80","messages":"81","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"82","messages":"83","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"84","messages":"85","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"86","messages":"87","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"88","messages":"89","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"90","usedDeprecatedRules":"77"},{"filePath":"91","messages":"92","errorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"93","usedDeprecatedRules":"77"},{"filePath":"94","messages":"95","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"96","usedDeprecatedRules":"77"},{"filePath":"97","messages":"98","errorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"99","usedDeprecatedRules":"77"},{"filePath":"100","messages":"101","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"102","usedDeprecatedRules":"77"},{"filePath":"103","messages":"104","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"105","usedDeprecatedRules":"77"},{"filePath":"106","messages":"107","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"108","usedDeprecatedRules":"77"},{"filePath":"109","messages":"110","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"111","messages":"112","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"113","messages":"114","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"115","messages":"116","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":1,"source":"117","usedDeprecatedRules":"77"},{"filePath":"118","messages":"119","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"120","messages":"121","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"122","messages":"123","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"124","messages":"125","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"126","messages":"127","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"128","messages":"129","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"130","messages":"131","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"132","usedDeprecatedRules":"77"},{"filePath":"133","messages":"134","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"135","usedDeprecatedRules":"77"},{"filePath":"136","messages":"137","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"138","messages":"139","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"140","messages":"141","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"142","messages":"143","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"144","usedDeprecatedRules":"77"},{"filePath":"145","messages":"146","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"147","usedDeprecatedRules":"77"},{"filePath":"148","messages":"149","errorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"150","usedDeprecatedRules":"151"},{"filePath":"152","messages":"153","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"151"},{"filePath":"154","messages":"155","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"151"},{"filePath":"156","messages":"157","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"77"},{"filePath":"158","messages":"159","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"160","usedDeprecatedRules":"77"},{"filePath":"161","messages":"162","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},"/home/rmdadmin/Docs/aloop-frontend/src/index.tsx",["163"],"import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/app/App';\nimport reportWebVitals from './reportWebVitals';\nimport { gsaTheme } from './style/theme';\nimport { Provider } from '@fluentui/react-northstar';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider theme={gsaTheme}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals();\n",["164","165"],"/home/rmdadmin/Docs/aloop-frontend/src/style/theme.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/components/app/App.tsx",["166","167","168"],"/home/rmdadmin/Docs/aloop-frontend/src/style/fontFaces.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/style/colors.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/components/app/authReducer.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/components/app/SocketProvider.tsx",["169"],"import React, { createContext, useContext, useRef } from 'react'\nimport { RTCSocket } from '../../utils/sockets/socketTemp';\nimport { Option } from '../../utils/types'\n\ninterface Props {\n\n}\n\ninterface SocketApiContext {\n    socket: Option<React.MutableRefObject<Option<RTCSocket>>>,\n    connectWebsocket: (user_id: number) => void\n\n}\n\nexport const SocketContext = createContext<SocketApiContext>({ socket: undefined, connectWebsocket: () => { } })\n\nexport const SocketProvider: React.FC<Props> = ({ children }) => {\n    const socket = useRef<Option<RTCSocket>>(undefined);\n    const connectWebsocket = (user_id: number) => {\n        if ((!socket.current || socket.current?.ws.readyState === WebSocket.CLOSED)) {\n            // Connect\n            socket.current = new RTCSocket(user_id).setSocketHandlers();\n        }\n    }\n\n    return (\n        <SocketContext.Provider value={{ socket, connectWebsocket }}>\n            {children}\n        </SocketContext.Provider>\n    )\n}","/home/rmdadmin/Docs/aloop-frontend/src/routes/Router.tsx",["170","171","172","173","174","175"],"import React, { ReactElement } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n} from \"react-router-dom\";\nimport RegisterPage from \"../pages/Auth/RegisterPage\";\nimport { LOGIN_PATH, REGISTER_PATH } from \"./Paths\";\nimport CenteredPage from \"../pages/templates/CenteredPage\";\nimport { VideoCall } from \"../components/video/VideoCall\";\nimport LoginPage from \"../pages/Auth/LoginPage\";\nimport { HomePage } from \"../pages/HomePage\";\nimport ProfilePage from \"../pages/Auth/ProfilePage\";\nimport { VideoRooms } from \"../components/video/VideoRooms\";\nimport { SidePanel } from '../components/video/SidePanel';\nimport { VideoPage } from \"../pages/VideoPage\";\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default () => {\n  // const [{ data: loginData }] = useGetOwnEmailQuery();\n\n  // const onlyLoggedIn = (page: ReactElement, alt: ReactElement = <Redirect to=\"/login\" />) => loginData?.getSelf?.email ? page : alt\n  // const onlyLoggedOut = (page: ReactElement, alt: ReactElement = <Redirect to=\"/\" />) => !loginData?.getSelf?.email ? page : alt\n\n  // const self = useGetSelfQuery();\n\n  return (\n    <Switch>\n      <Route exact path=\"/\">\n        <HomePage />\n      </Route>\n      <Route path={LOGIN_PATH}>\n        {/* {onlyLoggedOut(<LoginPage />)} */}\n        <LoginPage />\n      </Route>\n      <Route path={REGISTER_PATH}>\n        <RegisterPage />\n      </Route>\n      <Route path={\"/video\"}>\n        <VideoPage />\n      </Route>\n      <Route path={\"/profile\"}>\n        <ProfilePage />\n      </Route>\n      {/* <Route path={PASS_RESET_PATH}>\n        {onlyLoggedOut(<ForgotPasswordPage />)}\n      </Route> */}\n      {/* <Route path={PASS_RESET_PATH + '/:token'}>\n        {onlyLoggedOut(<PasswordResetPage />)}\n      </Route> */}\n      <Route path=\"*\">\n        {/* <ErrorPage error={{ number: 404, message: \"Page not found\" }}></ErrorPage> */}\n      </Route>\n    </Switch>\n  )\n}","/home/rmdadmin/Docs/aloop-frontend/src/utils/sockets/socketTemp.tsx",["176","177"],"import { MessageRes, TEXT_CHANNEL_MESSAGES_CACHE_KEY } from '../../api/messageQueries'\nimport { queryClient } from '../../components/app/App'\nimport { BASE_SOCKET_URL } from '../../config'\ntype ActionHandler = (json: any) => void\nconst HANDLE_CONNECTION_ACTION = 'HANDLE_COLLECTION'\nconst OFFER_ACTION = \"OFFER\"\nconst CANDIDATE_ACTION = \"CANDIDATE\"\nconst ANSWER_ACTION = \"ANSWER\"\ntype Actions = typeof CANDIDATE_ACTION | typeof OFFER_ACTION | typeof ANSWER_ACTION | typeof HANDLE_CONNECTION_ACTION\nconst MESSAGE_ACTION = \"NEW_MESSAGE\"\n\ninterface OneToOneData {\n    protocol: '1:1',\n    data: any,\n    from: number,\n    to: number,\n    room: String,\n    action: Actions\n}\n\ninterface OneToAllData {\n    protocol: '1:A',\n    data: any,\n    from: number,\n    room: String,\n    action: Actions\n}\n\n\nexport class RTCSocket {\n    ws: WebSocket;\n    connections: Map<number, RTCPeerConnection>;\n    client_id: number;\n    actionHandlers: { [key: string]: ActionHandler }\n    updateTracks = (id: number) => { }\n    setCallMembers?: React.Dispatch<React.SetStateAction<number[]>>;\n    setUnseenCounter?: React.Dispatch<React.SetStateAction<number[]>>\n\n    changeSetUnseetCounter = (counterFunc: React.Dispatch<React.SetStateAction<number[]>> | undefined) => {\n        this.setUnseenCounter = counterFunc\n    }\n\n    constructor(client_id: number) {\n        this.ws = new WebSocket(`${BASE_SOCKET_URL}/signalling/`);\n        // this.localConnection = new RTCPeerConnection();\n        this.connections = new Map<number, RTCPeerConnection>();\n        this.client_id = client_id\n        this.actionHandlers = {}\n    }\n\n\n\n\n    setSocketHandlers = () => {\n        // const ws = this.ws;\n        this.ws.onopen = (e) => {\n            console.log('Websocket Connection');\n        };\n        this.ws.onmessage = async (e) => {\n            const json = JSON.parse(e.data);\n            console.log(\"Handling\", (json.from !== this.client_id && (!json.to || json?.to === this.client_id)) || (!json.from && !json?.to))\n\n            if ((json.from !== this.client_id && (!json.to || json?.to === this.client_id)) || (!json.from && !json?.to)) {\n                switch (json.action) {\n                    case HANDLE_CONNECTION_ACTION:\n                        console.log('NEW PEER WANTS TO CONNECT');\n                        // This means that a new peer is attempting to connect\n                        // A peer must be set up\n                        await this.addPeer(json.from, json.room);\n                        break;\n                    case OFFER_ACTION:\n                        console.log('GOT OFFER FROM A NODE WE WANT TO CONNECT TO');\n                        console.log('THE NODE IS', json.from);\n                        await this.processOffer(json.from, json.room, json.data);\n                        break;\n                    case CANDIDATE_ACTION:\n                        console.log('NEW Candidate');\n                        const candidate_connection = this.connections.get(json.from);\n                        if (candidate_connection) {\n                            candidate_connection.addIceCandidate(new RTCIceCandidate(json.data));\n                            this.connections.set(json.from, candidate_connection)\n                        }\n                        break;\n                    case ANSWER_ACTION:\n                        console.log('--- GOT ANSWER IN CONNECT ---');\n                        const connection = this.connections.get(json.from);\n                        // console.log('HJAHSDHASHDHASDHASDHASDHASDASDHASDasdasdasd', json.from);\n                        if (connection) {\n                            connection.setRemoteDescription(new RTCSessionDescription(json.data));\n                            this.connections.set(json.from, connection)\n                        }\n                        break;\n                    case MESSAGE_ACTION:\n                        // Optimisticly update the frontend\n                        console.log(\"UPdating messages\")\n                        queryClient.setQueryData<MessageRes[]>([TEXT_CHANNEL_MESSAGES_CACHE_KEY, json.message.text_channel_id], old => old ? [...old, json.message] : [])\n                        // Add to unseen notifications\n\n                        if (this.setUnseenCounter) {\n                            console.log(\"UPdating Counter\")\n                            this.setUnseenCounter((oldCounter) => {\n                                if (oldCounter[json.message.text_channel_id]) {\n                                    oldCounter[json.message.text_channel_id] = oldCounter[json.message.text_channel_id]++\n                                } else {\n                                    oldCounter[json.message.text_channel_id] = 1\n                                }\n                                return [...oldCounter]\n                            })\n                        }\n\n                        console.log(\"Invalidatre\")\n                        // Invalidate data and refresh\n                        queryClient.invalidateQueries([TEXT_CHANNEL_MESSAGES_CACHE_KEY, json.message.text_channel_id])\n                        break\n                    default:\n                        for (const handler in this.actionHandlers) {\n                            console.log(\"Attempting handler\", handler)\n                            this.actionHandlers[handler](json)\n                        }\n                }\n\n                switch (json.protocol) {\n                    case 'GET_ONLINE_USERS':\n                        //DO SOMETHING\n                        //! onGetOnlineUsers(json);\n                        break;\n                }\n            };\n        }\n        return this;\n    };\n\n    makeConnection = (room: String, setCallMembers: React.Dispatch<React.SetStateAction<number[]>>): boolean => {\n        if (this.ws.readyState === WebSocket.OPEN) {\n            console.log('Connected -> sending negotiations',);\n            this.setCallMembers = setCallMembers\n            this.sendOneToAllNegotiation(HANDLE_CONNECTION_ACTION, room, this.client_id)\n            return true;\n        } else {\n            return false;\n        }\n    };\n\n\n\n\n\n    addPeer = async (requester_id: number, room: String,) => {\n        console.log('CONNECTING PEERS');\n        // Create the local connection and its event listeners\n        let connection = new RTCPeerConnection();\n        connection.onicecandidate = (iceEvent) => {\n            // Send the ice candidate\n            if (iceEvent.candidate) {\n                this.sendOneToOneNegotiation(CANDIDATE_ACTION, room, requester_id, iceEvent.candidate);\n            }\n        };\n        this.connections.set(requester_id, connection);\n        this.updateTracks(requester_id)\n        this.setCallMembers ? this.setCallMembers(members => [...Array.from(new Set([...members, requester_id]))]) : console.error(\"Didnt set call mebers\")\n        connection = this.connections.get(requester_id) || new RTCPeerConnection();\n\n        // Send an offer to the peer\n        await connection.createOffer({ offerToReceiveVideo: true })\n            .then((offer) => {\n                connection.setLocalDescription(offer);\n                this.sendOneToOneNegotiation(OFFER_ACTION, room, requester_id, offer);\n                console.log('------ SEND OFFER ------');\n                this.connections.set(requester_id, connection);\n                // this.updateTracks()\n            })\n            .catch((err) => {\n                throw err;\n            });\n        // Add the peer to the conenctions map\n    };\n\n\n    processOffer = async (requester: number, room: String, remoteOffer: RTCSessionDescriptionInit) => {\n        console.log('RUNNING PROCESS OFFER', requester, this.connections);\n        // let localConnection = new RTCPeerConnection({});\n        const connection = this.connections.get(requester)\n        if (connection) {\n            connection.onicecandidate = (event) => {\n                if (event.candidate) {\n                    this.sendOneToOneNegotiation(CANDIDATE_ACTION, room, requester, event.candidate);\n                }\n            };\n\n            // SEND ANSWER\n            //   setCallerId(json.from);\n            connection.setRemoteDescription(new RTCSessionDescription(remoteOffer));\n            await connection.createAnswer().then((localDescription) => {\n                connection.setLocalDescription(localDescription);\n                console.log('------ SEND ANSWER ------');\n                this.sendOneToOneNegotiation(ANSWER_ACTION, room, requester, localDescription);\n                this.connections.set(requester, connection);\n            }).catch(err => console.error(err));\n        } else {\n            console.error(\"No connection>? Retrying\")\n            this.connections.set(requester, new RTCPeerConnection())\n            this.updateTracks(requester)\n            this.setCallMembers ? this.setCallMembers(members => [...Array.from(new Set([...members, requester]))]) : console.error(\"Didnt set call mebers\")\n            this.processOffer(requester, room, remoteOffer)\n        }\n    }\n\n    // Send connection request to a specific endpoint-id\n    sendOneToAllNegotiation = (\n        action: Actions,\n        room: String,\n        // endpoint: any,\n        data: any,\n    ) => {\n        console.log('Action:', action, !!this.ws);\n        this.ws.send(\n            JSON.stringify({\n                protocol: '1:A',\n                from: this.client_id,\n                room: room,\n                // endpoint: endpoint,\n                action,\n                data: data,\n            })\n        );\n    };\n\n    // // Send connection request to a specific endpoint-id\n    sendOneToOneNegotiation = (\n        action: Actions,\n        room: String,\n        to: number,\n        data: any,\n    ) => {\n        console.log('Action:', action, !!this.ws);\n        this.ws.send(\n            JSON.stringify({\n                protocol: '1:1',\n                from: this.client_id,\n                room,\n                to,\n                action,\n                data: data,\n            })\n        );\n    };\n\n\n\n\n\n\n    setTracks = (gotRemoteStream: (e: any, id: number) => void, stream: MediaStream,) => {\n        const extendedGotRemoteStream = (id: number) => (e: any) => {\n            gotRemoteStream(e, id)\n        }\n\n        this.updateTracks = (id: number) => {\n            const connection = this.connections.get(id)\n            stream.getTracks().forEach(track => {\n                // Add the Add the track and add a listenr\n                if (connection) {\n                    connection.addTrack(track, stream);\n                    // Loop through all tracks and then set the stream handler\n                    connection.ontrack = extendedGotRemoteStream(id)\n                    this.connections.set(id, connection)\n                }\n            })\n        }\n    }\n\n    emptyTracks = (/*requester: number*/) => {\n        // this.localConnection.ontrack = () => { }\n        // this.localConnection = new RTCPeerConnection()\n        // this.localConnection = new RTCPeerConnection()\n        // this.connections.delete(requester)\n        // this.connections = new Map()\n    }\n\n\n    joinVidChan = (room: String, action: (json: any) => void) => {\n        this.ws.send(JSON.stringify({\n            room,\n            from: this.client_id,\n            protocol: 'JOIN_VIDCHAN',\n        }))\n        this.actionHandlers[\"ROOM_JOIN\"] = (json) => {\n            console.log()\n            if (json.action === \"ROOM_JOIN\" && json.user_id === this.client_id) {\n                action(json)\n            }\n        }\n    }\n\n    clearHandler = (action: string) => {\n        delete this.actionHandlers[action]\n    }\n}","/home/rmdadmin/Docs/aloop-frontend/src/pages/VideoPage.tsx",["178","179","180","181","182","183","184","185","186","187","188","189","190"],"import { MenuButton, Button, Flex, Menu, MenuItemProps, MenuShorthandKinds, ShorthandCollection, Chat, Text, Label } from '@fluentui/react-northstar'\nimport React, { useContext, useEffect, useMemo, useState } from 'react'\nimport { useGetVideoChannelQuery } from '../api/videoQueries'\nimport { useGetTextChannelQuery } from '../api/messageQueries'\nimport { VideoCall } from '../components/video/VideoCall'\nimport { CancelIcon, MessageChannelIcon, VertMenuIcon } from '../style/icons'\nimport { gsaTheme } from '../style/theme'\nimport { makeAction, makeMenuAction } from '../utils/MakeAction'\nimport CenteredPage from './templates/CenteredPage'\nimport { SocketContext } from '../components/app/SocketProvider'\nimport { ChatWindow } from '../components/chat/ChatWindow'\nimport { AuthUserContext } from '../components/app/App'\ninterface Props {\n\n}\n\nexport const VideoPage: React.FC<Props> = ({ children }) => {\n    const { data: vidChanData, error, isFetching } = useGetVideoChannelQuery();\n    const { data: textChanData, error: textChanError, isFetching: textChanIsFetching } = useGetTextChannelQuery();\n    // const { data: textChanData, error: textChanError, isFetching: textChanIsFetching } = useGetTextChannelQuery();\n    const [selectedRoom, setSelectedRoom] = useState<undefined | String>(undefined)\n    const socketContext = useContext(SocketContext)\n    const authContext = useContext(AuthUserContext);\n    const [selectedTextChan, setSelectedTextChan] = useState<[number, String] | undefined>(undefined)\n    const [unseenCounter, setUnseenCounter] = useState<number[]>([])\n    const divider = (id: number) => ({\n        key: 'divider' + id,\n        kind: 'divider',\n    })\n\n    const textChanMenu: ShorthandCollection<MenuItemProps, MenuShorthandKinds> = useMemo(() => [\n        {\n            key: 'heading1',\n            content: \"Text Channels\",\n            kind: \"divider\",\n\n        },\n        divider(1),\n    ], [])\n\n    const vidChanMenu: ShorthandCollection<MenuItemProps, MenuShorthandKinds> = useMemo(() => [\n        {\n            key: 'heading2',\n            content: \"Video Rooms\",\n            kind: \"divider\",\n\n        },\n        divider(2),\n    ], [])\n\n    const [textMenuItems, setTextMenuItems] = useState(textChanMenu)\n    const [vidMenuItems, setVidMenuItems] = useState(vidChanMenu)\n\n    const setRoom = useMemo(() => (room: String) => {\n        socketContext?.socket?.current?.joinVidChan(room, (action) => {\n            console.log(\"Selecting room:\", `${room}`)\n            setSelectedRoom(`#?${room}`)\n        })\n    }, [socketContext?.socket])\n\n    useEffect(() => {\n        if (textChanData && authContext?.selfState.user) {\n            setTextMenuItems([\n                ...textChanMenu,\n                ...textChanData.map((channel) => ({\n                    key: channel.text_channel_id,\n                    icon: <MessageChannelIcon />,\n                    role_id: authContext?.selfState.user?.role_id,\n                    unseen: unseenCounter[channel.text_channel_id],\n                    content: (\n                        <Text content={channel.channel_name} />\n                    ),\n                    action: () => {\n                        setSelectedTextChan([channel.text_channel_id, channel.channel_name])\n                        setUnseenCounter(oldCounter => {\n                            oldCounter[channel.text_channel_id] = 0\n                            return [...oldCounter]\n                        })\n                    },\n                    children: makeMenuAction,\n                })),\n            ])\n        }\n    }, [textChanData, unseenCounter, authContext?.selfState.user, textChanMenu])\n\n\n    useEffect(() => {\n        if (vidChanData) {\n            setVidMenuItems(() => ({\n                ...vidChanMenu,\n                ...vidChanData.map((channel) => ({\n                    key: channel.video_channel_id,\n                    content: channel.channel_name,\n                    action: () => {\n                        setRoom(channel.channel_name)\n                    },\n                    children: makeAction,\n                }))\n            }))\n        }\n    }, [setRoom, vidChanData, vidChanMenu])\n\n\n\n\n    useEffect(() => {\n        socketContext?.socket?.current?.changeSetUnseetCounter(setUnseenCounter);\n        return () => {\n            socketContext?.socket?.current?.clearHandler(\"ROOM_JOIN\");\n            socketContext?.socket?.current?.changeSetUnseetCounter(undefined);\n        }\n    }, [socketContext?.socket])\n\n\n    return (\n        <>\n            <Flex style={{ width: '100vw', height: '100vh' }}>\n                <Flex style={{ width: '16rem', position: 'relative', top: 0, left: 0, height: '100vh', flexDirection: \"column\" }}>\n                    <Menu\n                        styles={{ height: '50vh', width: '100%', backgroundColor: gsaTheme.siteVariables.colors.grey['50'] }}\n                        items={textMenuItems}\n                        pointing\n                        vertical\n                    />\n                    <Menu\n                        styles={{ height: '50vh', width: '100%', backgroundColor: gsaTheme.siteVariables.colors.grey['50'] }}\n                        items={vidMenuItems}\n                        pointing\n                        vertical\n                    />\n\n                </Flex>\n                {selectedTextChan !== undefined ? (\n                    <ChatWindow selectedTextChan={selectedTextChan} setSelectedTextChan={setSelectedTextChan} />\n                ) : \"\"}\n\n                {/* <VideoCall selectedRoom={selectedRoom}></VideoCall> */}\n            </Flex>\n        </>\n    )\n}\n","/home/rmdadmin/Docs/aloop-frontend/src/routes/Paths.ts",["191"],"export const LOGIN_PATH = '/login';\nexport const REGISTER_PATH = '/register';\nexport const PASS_RESET_PATH = '/register';\nexport const SELF_PATH = `/self`;\nexport const USER_PATH = '/user';\n\nexport const USERS_PATH = `${USER_PATH}s`;\n\n// Crud suffixes\nconst CREATE_SUFFIX = '/new';\n","/home/rmdadmin/Docs/aloop-frontend/src/pages/Auth/ProfilePage.tsx",["192","193","194","195"],"import React, { ReactElement, useEffect } from 'react';\nimport CenteredPage from '../templates/CenteredPage';\nimport { Link, Redirect } from 'react-router-dom';\nimport { LOGIN_PATH, } from '../../routes/Paths';\nimport { useGetSelfQuery } from '../../api/authQueries';\nimport { Flex, Loader, Text } from '@fluentui/react-northstar'\n\nconst ProfilePage = (): ReactElement => {\n    // const authenticated = false\n\n    // const cache = useQueryCache();\n    const { status, data, error, isFetching } = useGetSelfQuery();\n\n    return isFetching ? (<Loader />) : !error ?\n        (\n            <CenteredPage>\n                <h1>Welcome {data.email}</h1>\n            </CenteredPage>\n        )\n        : (\n            // <Redirect to={LOGIN_PATH} />\n            <CenteredPage>\n                <Text error>{typeof error === \"string\" ? error : \"Authentication Error: Timeout\"}</Text>\n                <Link to={LOGIN_PATH}>Login</Link>\n            </CenteredPage>\n        )\n\n\n}\n\n\nexport default ProfilePage;\n","/home/rmdadmin/Docs/aloop-frontend/src/pages/HomePage.tsx",["196"],"import { Flex, Loader, Text } from '@fluentui/react-northstar'\nimport React, { useContext } from 'react'\nimport { useQueryClient } from 'react-query'\nimport { Link } from 'react-router-dom'\nimport { useGetUsers } from '../api/authQueries'\nimport { AuthUserContext } from '../components/app/App'\nimport { LOGIN_PATH, REGISTER_PATH } from '../routes/Paths'\nimport CenteredPage from './templates/CenteredPage'\n\ninterface Props {\n\n}\n\nexport const HomePage: React.FC<Props> = ({ children }) => {\n    // const cache = useQueryClient();\n    const { data, error, isFetching } = useGetUsers();\n    const authcontext = useContext(AuthUserContext)\n\n\n    return (\n        <CenteredPage>\n            {/* {onlyLoggedIn(<Temp />, <h1>Welcome to Greenstar Aviation</h1>)} */}\n            <Flex styles={{ width: \"100%\", justifyContent: \"space-evenly\", margin: '2rem 10rem' }}>\n                {!authcontext?.selfState?.auth ?\n                    <>\n                        <Link to={LOGIN_PATH}>Login</Link>\n                        <Link to={REGISTER_PATH}>Register</Link>\n                    </> :\n                    <>\n                        <Link to='/video'>Video</Link>\n                        <Link to='/profile'>Profile</Link>\n                    </>}\n            </Flex>\n            <Text content=\"Users:\" size=\"largest\" weight=\"bold\" />\n            {\n                isFetching ?\n                    (<Loader />) :\n                    (error ? (<Text content=\"Error retrieving users\" error />) : (\n                        data.map((user: any) => (<Text content={user.first_name} key={user.user_id} />))\n                    ))\n            }\n\n\n        </CenteredPage>\n    )\n}","/home/rmdadmin/Docs/aloop-frontend/src/pages/Auth/LoginPage.tsx",[],"/home/rmdadmin/Docs/aloop-frontend/src/pages/Auth/RegisterPage.tsx",[],"/home/rmdadmin/Docs/aloop-frontend/src/api/authQueries.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/pages/templates/CenteredPage.tsx",["197","198","199"],"import React, { ReactElement } from 'react';\nimport { Button, Flex } from '@fluentui/react-northstar';\nimport { gsaTheme } from '../../style/theme';\n\ninterface Props {\n    vertCenter?: boolean\n}\n\nconst CenteredPage: React.FC<Props> = ({ children, vertCenter: vertCenter = false }) => (\n    <Flex styles={{ height: '100vh', overflowY: 'scroll', width: '100%', justifyContent: 'center', backgroundColor: gsaTheme.siteVariables.colors.grey[200] }}>\n        <Flex styles={{ minHeight: '80vh', height: 'fit-content', justifyContent: vertCenter ? 'center' : 'flex-start', alignItems: 'center', flexDirection: 'column', margin: '10vh 2rem', padding: '2rem', backgroundColor: gsaTheme.siteVariables.colors.white, width: 'min( 50rem, 100%)' }}>\n            {children}\n        </Flex>\n    </Flex>\n);\n\n\nexport default CenteredPage;\n","/home/rmdadmin/Docs/aloop-frontend/src/components/forms/Auth/LoginForm.tsx",[],"/home/rmdadmin/Docs/aloop-frontend/src/components/forms/Auth/RegisterForm.tsx",[],"/home/rmdadmin/Docs/aloop-frontend/src/api/defaults.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/config.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/utils/validators/passwordValidation.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/utils/validators/emailValidation.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/components/forms/template/FormTemplate.tsx",["200","201"],"import React, { ReactElement, useState } from 'react'\nimport { ComponentEventHandler, Form, FormButton, FormProps } from '@fluentui/react-northstar'\nimport { Redirect } from 'react-router-dom';\n\ninterface Props {\n    onSubmit?: ComponentEventHandler<FormProps>\n    success?: boolean,\n    fetching?: boolean\n    to?: string\n}\n\nexport const FormTemplate: React.FC<Props> = ({ children, onSubmit, success, fetching, to = '/' }) => {\n    return success ? <Redirect to={to} /> : (\n        <Form onSubmit={onSubmit} styles={{ justifyContent: 'start', width: 'auto', margin: '1rem 2rem' }}>\n            {children}\n            <FormButton content=\"Submit\" loading={fetching} disabled={fetching} fluid primary />\n        </Form>\n    )\n}\n\n","/home/rmdadmin/Docs/aloop-frontend/src/utils/forms/MakeForm.tsx",["202"],"import React, { RefObject } from 'react'\nimport { Form, FormInput } from \"@fluentui/react-northstar\"\nimport { DeepMap } from 'react-hook-form/dist/types/utils'\nimport { FieldError } from 'react-hook-form'\nimport { FormStateProxy } from 'react-hook-form/dist/types/form'\nimport { stringAsNestedSelector } from '../text/stringAsNestedSelector'\nimport { camel2Sentence } from '../text/camelToSentence'\n\n\n\n\nexport interface ShorthandField {\n    id: string,\n    label?: string,\n    type?: string,\n    validation?: Rules,\n}\n\n\nexport interface Rules {\n    required?: string | boolean\n    maxLength?: number,\n    minLength?: number,\n    pattern?: RegExp,\n    validate?: (value: string) => boolean | string\n}\n\n\n\n// Turn an array into a validated form - the form generated will be validated with react hook forms\nexport const MakeForm = (fields: ShorthandField[], errors: DeepMap<Record<string, any>, FieldError>, register: (rules: Rules) => ((instance: HTMLInputElement | null) => void) | RefObject<HTMLInputElement> | null | undefined, formState: FormStateProxy<Record<string, any>>) => {\n    const form = []\n    for (const field of fields) {\n        const humanLabel = field.label || camel2Sentence(field.id)\n        // PERFORMANCE??? - this only needs to be done for dynamic forms, good place to look at performance if slow\n        const error = stringAsNestedSelector<typeof errors>(errors, field.id);\n        const touched = stringAsNestedSelector<typeof formState.touched>(formState.touched, field.id);\n        form.push(<FormInput\n            label={humanLabel}\n            id={field.id}\n            key={field.id}\n            name={field.id}\n            type={field?.type}\n            ref={register(field?.validation || {})}\n            errorMessage={error && (error.message || \"Please input a valid \" + humanLabel)}\n            showSuccessIndicator={!error && touched\n            } />)\n    }\n    return form\n}","/home/rmdadmin/Docs/aloop-frontend/src/utils/text/stringAsNestedSelector.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/utils/text/camelToSentence.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/style/icons.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/api/videoQueries.ts",["203","204"],"import { useMutation, useQuery } from 'react-query';\nimport { getFetch, postFetch } from './defaults';\n\nconst VIDEO_CHANNEL_CACHE_KEY = 'video_channel';\n\nexport interface VideoChannelRes {\n  video_channel_id: number;\n  channel_name: string;\n  created_at: string;\n}\n\nconst getVideoChannels = async () =>\n  getFetch('/vidchan')\n    .then((res) => {\n      console.log(res);\n      if (res.ok) {\n        return res.json();\n      } else {\n        throw new Error('Authentication Error');\n      }\n    })\n    .catch((e) => {\n      console.error('POST REQUEST ERROR', e);\n      throw e;\n    });\n\nexport const useGetVideoChannelQuery = () =>\n  useQuery<VideoChannelRes[]>(VIDEO_CHANNEL_CACHE_KEY, getVideoChannels);\n","/home/rmdadmin/Docs/aloop-frontend/src/utils/MakeAction.tsx",["205"],"import { Flex, Label, MenuButton, Button } from '@fluentui/react-northstar';\nimport React, { useState } from 'react'\nimport { VertMenuIcon } from '../style/icons';\n\nexport const makeAction = (Component: any, props: any) => {\n    const { action, ...restProps } = props;\n    return <Component {...restProps} onClick={action} />\n}\n\n\n\nexport const makeMenuAction = (Component: any, props: any) => {\n    // const { action, ...restProps } = props;\n    const { action, role_id, unseen, ...restProps } = props;\n    return (<Flex styles={{ alignItems: \"center\", justifyContent: \"space-between\", width: \"100%\" }} >\n        <   Component {...restProps} onClick={action} />\n        {\n            unseen && unseen > 0 ? <Label\n                // styles={{ position: \"absolute\", right: \"0.1rem\" }}\n                content={unseen}\n                // color={\"\"}\n                circular\n            /> : \"\"\n        }\n        {\n            role_id !== 2 ? <MenuButton trigger={<Button iconOnly text icon={<VertMenuIcon />} />}>\n\n            </MenuButton> : \"\"\n        }\n    </Flex >)\n}","/home/rmdadmin/Docs/aloop-frontend/src/components/video/VideoCall.tsx",["206","207","208","209","210"],"import { Button, Grid } from '@fluentui/react-northstar'\nimport React, { useEffect, useRef, useState, useContext } from 'react'\nimport { useRefArrayCallback } from '../../utils/useRefCallback';\nimport { AuthUserContext } from '../app/App';\nimport { SocketContext } from '../app/SocketProvider';\nimport { VideoPanel } from './VideoPanel';\n// import { makeConnection, localConnection, client } from '../../utils/sockets/socket';!!!\n\ninterface Props {\n    selectedRoom: String | undefined\n}\n\nexport const VideoCall: React.FC<Props> = ({ children, selectedRoom }) => {\n    const authcontext = useContext(AuthUserContext)\n    const videoRef = useRef<HTMLVideoElement>(null);\n    const [incomingVidRef, setIncomingVidRef] = useRefArrayCallback<HTMLVideoElement>(\n        (vidRef) => {\n            if (vidRef.current) {\n                console.log(\"processing vidref\");\n                processVidRef(vidRef)\n            } else {\n                console.error(\"No process bruh\")\n            }\n        },\n        (vidRef) => {\n            //Drop connections\n        },\n        []);\n    // const [streamOut, setStream] = useState<MediaStream>()\n    const [inCall, setInCall] = useState(false);\n    const [callMessage, setCallMessage] = useState<string>(\"\")\n    const [callMembers, setCallMembers] = useState<number[]>([])\n    interface QMSG {\n        e: any,\n        id: number\n    }\n    const [vidQueue, setVidQueue] = useState<QMSG[]>([])\n\n\n    const socketContext = useContext(SocketContext)\n\n\n    const joinRoom = (room: String) => {\n        console.log(\"Joining Call\")\n        setInCall(true)\n        if (socketContext?.socket?.current?.makeConnection(room, setCallMembers)) {\n            console.log(\"Connected!\")\n        } else {\n            setInCall(false)\n            console.log(\"Could not connect\")\n            setCallMessage(\"Could not connect\")\n        }\n    }\n\n    const pipeErr = (err: Error) => { throw err }\n\n    useEffect(() => {\n        // console.log(navigator.mediaDevices.getUserMedia({ audio: false, video: true }).then)\n        if (!navigator.mediaDevices?.getUserMedia({ audio: false, video: true })\n            .then((stream) => {\n                // console.log(\"Stream\")\n                if (videoRef?.current) {\n                    videoRef.current.srcObject = stream\n                    console.log(\"Adding Stream\", socketContext?.socket?.current)\n                    // socketContext?.socket?.current?.localConnection.ontrack = gotRemoteStream;\n                    socketContext?.socket?.current?.setTracks(gotRemoteStream, stream)\n                    // stream.getTracks().forEach(track => localConnection.addTrack(track, stream));\n                    //! setStream(stream)\n                    // !makeVideoCall(stream)\n                } else {\n                    // console.log(\"oh nowy\")\n                }\n            }).catch((err) => console.error(`Error getting media device`, err))) {\n            // There are no media devices\n            setCallMessage(\"No media devices found, is your camera / microphone connected?\")\n        } else {\n            // console.log(\"noVideo\")\n        };\n    }, [videoRef])\n\n    const canPlay = () => {\n        if (videoRef?.current) { videoRef.current.play() }\n    }\n\n    const gotRemoteStream = (e: any, id: number) => {\n        console.log(\"GOT reomte\", e)\n        if (incomingVidRef?.current && incomingVidRef.current[id] && incomingVidRef.current[id]?.srcObject !== e.streams[0]) {\n            incomingVidRef.current[id].srcObject = e.streams[0];\n        } else {\n            console.log(\"Adding to queue\", id)\n            setVidQueue((queue) => [...queue, { e, id }])\n        }\n    }\n\n    const processVidRef = (ref: React.MutableRefObject<HTMLVideoElement[] | undefined>) => {\n        if (ref.current) {\n            for (const message of vidQueue) {\n                if (ref.current[message.id]) {\n                    // Process the queue\n                    gotRemoteStream(message.e, message.id);\n                    // Remove from the queue\n                    setVidQueue((queue) => {\n                        return [...queue.splice(message.id, 1)]\n                    })\n                }\n            }\n        }\n    }\n\n    // useEffect(() => {\n    //     //     // This processes the queue as members come in, this is done becuase members can be added after the stream attempts to add the tracks and so may need to be reproccessed on a new item\n    //     //     for (const message of vidQueue) {\n    //     //         if (incomingVidRef.current[message.id]) {\n    //     //             gotRemoteStream(message.e, message.id);\n    //     //             setVidQueue((queue) => {\n    //     //                 return [...queue.splice(message.id, 1)]\n    //     //             })\n    //     //         }\n    //     //         // console.log(\"processing msg:\", message)\n    //     //         // const index = Array.from(callMembers).indexOf(message.id)\n    //     //         // if (index !== -1) {\n    //     //         //              // }\n    //     console.log(\"added CallMember\", callMembers)\n    // }, [callMembers])\n\n\n\n    const disconnectCall = () => {\n        //emptyTracks\n        socketContext?.socket?.current?.emptyTracks();;\n    }\n\n    useEffect(() => {\n        console.log(\"Joining selected Romm:\", selectedRoom)\n        if (selectedRoom) {\n            joinRoom(selectedRoom)\n        }\n        return disconnectCall\n    }, [selectedRoom])\n\n\n    return (\n        <Grid>\n            <div style={{ position: \"relative\" }}>\n                <video ref={videoRef} onCanPlay={canPlay} id=\"player\" autoPlay playsInline muted width=\"426\" height=\"240\" />\n                <p style={{ position: \"absolute\", color: 'green', top: 10, left: 10 }}>{`${authcontext?.selfState.user?.first_name || \"\"} ${authcontext?.selfState.user?.last_name || \"\"}`}</p>\n            </div>\n\n            {callMembers.map((member) =>\n            (\n                <>\n                    <VideoPanel videoRef={setIncomingVidRef(member)} key={member} />\n                </>)\n            )}\n            <p>{callMessage}</p>\n        </Grid>\n    )\n}",["211","212"],"/home/rmdadmin/Docs/aloop-frontend/src/components/video/VideoPanel.tsx",[],"/home/rmdadmin/Docs/aloop-frontend/src/utils/useRefCallback.tsx",[],"/home/rmdadmin/Docs/aloop-frontend/src/api/messageQueries.ts",[],"/home/rmdadmin/Docs/aloop-frontend/src/components/chat/ChatWindow.tsx",["213","214","215"],"import React, { SyntheticEvent, useContext, useRef, useState } from 'react'\nimport { Flex, Chat, Button, ChatItemProps, ShorthandCollection, Input } from \"@fluentui/react-northstar\"\nimport { CancelIcon, MessageIcon, SendIcon } from '../../style/icons'\nimport { gsaTheme } from '../../style/theme'\nimport { MessageRes, useGetTextChannelMessagesQuery, useNewMessageQuery } from '../../api/messageQueries'\nimport { AuthUserContext } from '../app/App'\n\ninterface Props {\n    setSelectedTextChan: React.Dispatch<React.SetStateAction<[number, String] | undefined>>\n    selectedTextChan: [number, String]\n}\n\nexport const ChatWindow: React.FC<Props> = ({ children, setSelectedTextChan, selectedTextChan }) => {\n    const { data, error, isFetching } = useGetTextChannelMessagesQuery(selectedTextChan[0]);\n    const { mutate } = useNewMessageQuery();\n    const authContext = useContext(AuthUserContext)\n    // const messageInput = useRef<HTMLInputElement | null>(null)\n    const [text, setText] = useState<string>('')\n\n\n    const mapDataToItems = (data: MessageRes[] | undefined): ShorthandCollection<ChatItemProps> => {\n        return data?.map((message) => ({\n            message: (\n                <Chat.Message content={message.contents}\n                    author={message.author_id}\n                    timestamp={new Date(Date.parse(message.created_at)).toLocaleString()}\n                    mine={message.author_id === authContext?.selfState.user?.user_id} />\n            ),\n            // contentPosition: message.author_id === authContext?.selfState.user?.user_id ? 'end' : 'start',\n            attached: 'top',\n            key: 'message-id-' + message.message_id,\n        })) || []\n    }\n\n    const sendMessage = () => {\n        if (text) {\n            mutate({\n                contents: text,\n                text_channel_id: selectedTextChan[0]\n            })\n            setText(\"\")\n        } else {\n            console.log(\"No value\")\n        }\n    }\n\n    return (\n        <Flex style={{ width: '24rem', height: '100%', position: \"relative\", top: 0, left: 0, flexDirection: \"column\" }}>\n            <Chat style={{ width: \"100%\", padding: 0, flex: 1, overflowY: 'scroll', flexDirection: 'column-reverse' }} items={mapDataToItems(data).reverse().slice(0, 10)} />\n            <Flex style={{ width: \"100%\", padding: \"1rem 0 1rem 0\", backgroundColor: gsaTheme.siteVariables.colors.grey['100'] }} >\n                <Input\n                    fluid\n                    placeholder={\"Message \" + selectedTextChan[1]}\n                    iconPosition=\"start\"\n                    icon={<MessageIcon />}\n                    value={text}\n                    onKeyDown={(e) => {\n                        if (e.key === 'Enter') {\n                            sendMessage()\n                        }\n                    }}\n                    onChange={(e) => {\n                        const event = e as SyntheticEvent<HTMLInputElement, Event>;\n                        setText(event?.currentTarget?.value || \"\")\n                    }} />\n                <Button\n                    onClick={sendMessage}\n                    icon={<SendIcon />} iconOnly title=\"Send\" circular />\n            </Flex>\n            <Button onClick={() => { setSelectedTextChan(undefined) }} styles={{\n                alignSelf: 'flex-end', position: 'absolute', top: '1rem', right: '-1rem', ':hover': {\n                    backgroundColor: gsaTheme.siteVariables.colors.grey['800'],\n                },\n            }} icon={<CancelIcon />} iconOnly title=\"Close\" circular />\n        </Flex>\n    )\n}","/home/rmdadmin/Docs/aloop-frontend/src/components/StartupChecks.tsx",["216"],{"ruleId":"217","severity":1,"message":"218","line":5,"column":8,"nodeType":"219","messageId":"220","endLine":5,"endColumn":23},{"ruleId":"221","replacedBy":"222"},{"ruleId":"223","replacedBy":"224"},{"ruleId":"217","severity":1,"message":"225","line":1,"column":32,"nodeType":"219","messageId":"220","endLine":1,"endColumn":41},{"ruleId":"217","severity":1,"message":"226","line":4,"column":10,"nodeType":"219","messageId":"220","endLine":4,"endColumn":16},{"ruleId":"217","severity":1,"message":"227","line":12,"column":10,"nodeType":"219","messageId":"220","endLine":12,"endColumn":25},{"ruleId":"217","severity":1,"message":"228","line":1,"column":32,"nodeType":"219","messageId":"220","endLine":1,"endColumn":42},{"ruleId":"217","severity":1,"message":"229","line":1,"column":17,"nodeType":"219","messageId":"220","endLine":1,"endColumn":29},{"ruleId":"217","severity":1,"message":"230","line":3,"column":20,"nodeType":"219","messageId":"220","endLine":3,"endColumn":26},{"ruleId":"217","severity":1,"message":"231","line":9,"column":8,"nodeType":"219","messageId":"220","endLine":9,"endColumn":20},{"ruleId":"217","severity":1,"message":"232","line":10,"column":10,"nodeType":"219","messageId":"220","endLine":10,"endColumn":19},{"ruleId":"217","severity":1,"message":"233","line":14,"column":10,"nodeType":"219","messageId":"220","endLine":14,"endColumn":20},{"ruleId":"217","severity":1,"message":"234","line":15,"column":10,"nodeType":"219","messageId":"220","endLine":15,"endColumn":19},{"ruleId":"217","severity":1,"message":"235","line":12,"column":11,"nodeType":"219","messageId":"220","endLine":12,"endColumn":23},{"ruleId":"217","severity":1,"message":"236","line":21,"column":11,"nodeType":"219","messageId":"220","endLine":21,"endColumn":23},{"ruleId":"217","severity":1,"message":"237","line":1,"column":10,"nodeType":"219","messageId":"220","endLine":1,"endColumn":20},{"ruleId":"217","severity":1,"message":"226","line":1,"column":22,"nodeType":"219","messageId":"220","endLine":1,"endColumn":28},{"ruleId":"217","severity":1,"message":"238","line":1,"column":98,"nodeType":"219","messageId":"220","endLine":1,"endColumn":102},{"ruleId":"217","severity":1,"message":"239","line":1,"column":110,"nodeType":"219","messageId":"220","endLine":1,"endColumn":115},{"ruleId":"217","severity":1,"message":"232","line":5,"column":10,"nodeType":"219","messageId":"220","endLine":5,"endColumn":19},{"ruleId":"217","severity":1,"message":"240","line":6,"column":10,"nodeType":"219","messageId":"220","endLine":6,"endColumn":20},{"ruleId":"217","severity":1,"message":"241","line":6,"column":42,"nodeType":"219","messageId":"220","endLine":6,"endColumn":54},{"ruleId":"217","severity":1,"message":"231","line":9,"column":8,"nodeType":"219","messageId":"220","endLine":9,"endColumn":20},{"ruleId":"217","severity":1,"message":"242","line":18,"column":32,"nodeType":"219","messageId":"220","endLine":18,"endColumn":37},{"ruleId":"217","severity":1,"message":"243","line":18,"column":39,"nodeType":"219","messageId":"220","endLine":18,"endColumn":49},{"ruleId":"217","severity":1,"message":"244","line":19,"column":40,"nodeType":"219","messageId":"220","endLine":19,"endColumn":53},{"ruleId":"217","severity":1,"message":"245","line":19,"column":67,"nodeType":"219","messageId":"220","endLine":19,"endColumn":85},{"ruleId":"217","severity":1,"message":"246","line":21,"column":12,"nodeType":"219","messageId":"220","endLine":21,"endColumn":24},{"ruleId":"217","severity":1,"message":"247","line":10,"column":7,"nodeType":"219","messageId":"220","endLine":10,"endColumn":20},{"ruleId":"217","severity":1,"message":"225","line":1,"column":31,"nodeType":"219","messageId":"220","endLine":1,"endColumn":40},{"ruleId":"217","severity":1,"message":"248","line":3,"column":16,"nodeType":"219","messageId":"220","endLine":3,"endColumn":24},{"ruleId":"217","severity":1,"message":"249","line":6,"column":10,"nodeType":"219","messageId":"220","endLine":6,"endColumn":14},{"ruleId":"217","severity":1,"message":"250","line":12,"column":13,"nodeType":"219","messageId":"220","endLine":12,"endColumn":19},{"ruleId":"217","severity":1,"message":"251","line":3,"column":10,"nodeType":"219","messageId":"220","endLine":3,"endColumn":24},{"ruleId":"217","severity":1,"message":"229","line":1,"column":17,"nodeType":"219","messageId":"220","endLine":1,"endColumn":29},{"ruleId":"217","severity":1,"message":"226","line":2,"column":10,"nodeType":"219","messageId":"220","endLine":2,"endColumn":16},{"ruleId":"252","severity":1,"message":"253","line":9,"column":52,"nodeType":"254","messageId":"255","endLine":9,"endColumn":82,"fix":"256"},{"ruleId":"217","severity":1,"message":"229","line":1,"column":17,"nodeType":"219","messageId":"220","endLine":1,"endColumn":29},{"ruleId":"217","severity":1,"message":"257","line":1,"column":31,"nodeType":"219","messageId":"220","endLine":1,"endColumn":39},{"ruleId":"217","severity":1,"message":"258","line":2,"column":10,"nodeType":"219","messageId":"220","endLine":2,"endColumn":14},{"ruleId":"217","severity":1,"message":"259","line":1,"column":10,"nodeType":"219","messageId":"220","endLine":1,"endColumn":21},{"ruleId":"217","severity":1,"message":"260","line":2,"column":20,"nodeType":"219","messageId":"220","endLine":2,"endColumn":29},{"ruleId":"217","severity":1,"message":"257","line":2,"column":17,"nodeType":"219","messageId":"220","endLine":2,"endColumn":25},{"ruleId":"217","severity":1,"message":"226","line":1,"column":10,"nodeType":"219","messageId":"220","endLine":1,"endColumn":16},{"ruleId":"217","severity":1,"message":"261","line":30,"column":12,"nodeType":"219","messageId":"220","endLine":30,"endColumn":18},{"ruleId":"217","severity":1,"message":"262","line":55,"column":11,"nodeType":"219","messageId":"220","endLine":55,"endColumn":18},{"ruleId":"263","severity":1,"message":"264","line":79,"column":8,"nodeType":"265","endLine":79,"endColumn":18,"suggestions":"266"},{"ruleId":"263","severity":1,"message":"267","line":139,"column":8,"nodeType":"265","endLine":139,"endColumn":22,"suggestions":"268"},{"ruleId":"221","replacedBy":"269"},{"ruleId":"223","replacedBy":"270"},{"ruleId":"217","severity":1,"message":"271","line":1,"column":45,"nodeType":"219","messageId":"220","endLine":1,"endColumn":51},{"ruleId":"217","severity":1,"message":"242","line":14,"column":19,"nodeType":"219","messageId":"220","endLine":14,"endColumn":24},{"ruleId":"217","severity":1,"message":"243","line":14,"column":26,"nodeType":"219","messageId":"220","endLine":14,"endColumn":36},{"ruleId":"263","severity":1,"message":"272","line":24,"column":8,"nodeType":"265","endLine":24,"endColumn":21,"suggestions":"273"},"@typescript-eslint/no-unused-vars","'reportWebVitals' is defined but never used.","Identifier","unusedVar","no-native-reassign",["274"],"no-negated-in-lhs",["275"],"'useEffect' is defined but never used.","'Button' is defined but never used.","'useGetSelfQuery' is defined but never used.","'useContext' is defined but never used.","'ReactElement' is defined but never used.","'Router' is defined but never used.","'CenteredPage' is defined but never used.","'VideoCall' is defined but never used.","'VideoRooms' is defined but never used.","'SidePanel' is defined but never used.","'OneToOneData' is defined but never used.","'OneToAllData' is defined but never used.","'MenuButton' is defined but never used.","'Chat' is defined but never used.","'Label' is defined but never used.","'CancelIcon' is defined but never used.","'VertMenuIcon' is defined but never used.","'error' is assigned a value but never used.","'isFetching' is assigned a value but never used.","'textChanError' is assigned a value but never used.","'textChanIsFetching' is assigned a value but never used.","'selectedRoom' is assigned a value but never used.","'CREATE_SUFFIX' is assigned a value but never used.","'Redirect' is defined but never used.","'Flex' is defined but never used.","'status' is assigned a value but never used.","'useQueryClient' is defined but never used.","no-useless-rename","Destructuring assignment vertCenter unnecessarily renamed.","Property","unnecessarilyRenamed",{"range":"276","text":"277"},"'useState' is defined but never used.","'Form' is defined but never used.","'useMutation' is defined but never used.","'postFetch' is defined but never used.","'inCall' is assigned a value but never used.","'pipeErr' is assigned a value but never used.","react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'gotRemoteStream' and 'socketContext?.socket'. Either include them or remove the dependency array.","ArrayExpression",["278"],"React Hook useEffect has missing dependencies: 'disconnectCall' and 'joinRoom'. Either include them or remove the dependency array.",["279"],["274"],["275"],"'useRef' is defined but never used.","React Hook useEffect has missing dependencies: 'authcontext' and 'socketContext.connectWebsocket'. Either include them or remove the dependency array.",["280"],"no-global-assign","no-unsafe-negation",[247,277],"vertCenter = false",{"desc":"281","fix":"282"},{"desc":"283","fix":"284"},{"desc":"285","fix":"286"},"Update the dependencies array to be: [gotRemoteStream, socketContext?.socket, videoRef]",{"range":"287","text":"288"},"Update the dependencies array to be: [disconnectCall, joinRoom, selectedRoom]",{"range":"289","text":"290"},"Update the dependencies array to be: [authcontext, data, error, socketContext.connectWebsocket]",{"range":"291","text":"292"},[3121,3131],"[gotRemoteStream, socketContext?.socket, videoRef]",[5404,5418],"[disconnectCall, joinRoom, selectedRoom]",[784,797],"[authcontext, data, error, socketContext.connectWebsocket]"]